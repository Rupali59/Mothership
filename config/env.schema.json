{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Motherboard Environment Configuration Schema",
  "description": "Validation schema for all environment variables used across Motherboard services",
  "type": "object",
  "required": ["APP_ENV", "MONGO_URI", "REDIS_URL", "JWT_SECRET"],
  "properties": {
    "APP_ENV": {
      "type": "string",
      "enum": ["development", "staging", "production"],
      "description": "Deployment environment"
    },
    "PORT": {
      "type": "string",
      "pattern": "^[0-9]+$",
      "description": "Service port number"
    },
    "LOG_LEVEL": {
      "type": "string",
      "enum": ["debug", "info", "warn", "error"],
      "description": "Logging level"
    },
    "MONGO_URI": {
      "type": "string",
      "pattern": "^mongodb(\\+srv)?://.*",
      "description": "MongoDB connection URI"
    },
    "REDIS_URL": {
      "type": "string",
      "pattern": "^redis://.*",
      "description": "Redis connection URL"
    },
    "POSTGRES_CONN": {
      "type": "string",
      "pattern": "^postgres(ql)?://.*",
      "description": "PostgreSQL connection string"
    },
    "JWT_SECRET": {
      "type": "string",
      "minLength": 32,
      "description": "Secret key for JWT token signing (min 32 characters)"
    },
    "ENCRYPTION_KEY": {
      "type": "string",
      "minLength": 32,
      "description": "Encryption key for sensitive data (min 32 characters)"
    },
    "CORS_ALLOWED_ORIGINS": {
      "type": "string",
      "description": "Comma-separated list of allowed CORS origins"
    },
    "TRUSTED_PROXIES": {
      "type": "string",
      "description": "Comma-separated list of trusted proxy IPs"
    },
    "AUTH_SERVICE_URL": {
      "type": "string",
      "format": "uri",
      "description": "URL for Auth service"
    },
    "BILLING_SERVICE_URL": {
      "type": "string",
      "format": "uri",
      "description": "URL for Billing service"
    },
    "SCHEDULER_SERVICE_URL": {
      "type": "string",
      "format": "uri",
      "description": "URL for Scheduler service"
    },
    "HEALTH_SERVICE_URL": {
      "type": "string",
      "format": "uri",
      "description": "URL for Health service"
    },
    "ENTITLEMENT_SERVICE_URL": {
      "type": "string",
      "format": "uri",
      "description": "URL for Entitlement service"
    },
    "NOTIFICATION_SERVICE_URL": {
      "type": "string",
      "format": "uri",
      "description": "URL for Notification service"
    },
    "STORAGE_SERVICE_URL": {
      "type": "string",
      "format": "uri",
      "description": "URL for Storage service"
    },
    "TASK_TRACKER_SERVICE_URL": {
      "type": "string",
      "format": "uri",
      "description": "URL for Task Tracker service"
    },
    "ENABLE_WEBAUTHN": {
      "type": "string",
      "enum": ["true", "false"],
      "description": "Enable WebAuthn authentication"
    },
    "ENABLE_OAUTH": {
      "type": "string",
      "enum": ["true", "false"],
      "description": "Enable OAuth authentication"
    },
    "ENABLE_BILLING": {
      "type": "string",
      "enum": ["true", "false"],
      "description": "Enable billing features"
    },
    "MAX_DB_CONNECTIONS": {
      "type": "string",
      "pattern": "^[0-9]+$",
      "description": "Maximum database connection pool size"
    },
    "REQUEST_TIMEOUT": {
      "type": "string",
      "pattern": "^[0-9]+(ms|s|m|h)$",
      "description": "Request timeout duration (e.g., 30s, 5m)"
    },
    "CACHE_ENABLED": {
      "type": "string",
      "enum": ["true", "false"],
      "description": "Enable caching"
    },
    "CACHE_TTL": {
      "type": "string",
      "pattern": "^[0-9]+(ms|s|m|h)$",
      "description": "Cache time-to-live (e.g., 5m, 1h)"
    }
  },
  "if": {
    "properties": {
      "APP_ENV": { "const": "production" }
    }
  },
  "then": {
    "required": ["ENCRYPTION_KEY", "CORS_ALLOWED_ORIGINS"],
    "properties": {
      "LOG_LEVEL": {
        "enum": ["info", "warn", "error"],
        "not": { "const": "debug" }
      }
    }
  }
}
